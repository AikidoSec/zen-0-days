const { test } = require("node:test");
const { equal, throws } = require("node:assert");

test("Protects against Prototype Pollution", async () => {
  const dotProp = require("dot-prop");
  require("@aikidosec/firewall/nopp");

  equal({}.isPolluted, undefined);

  const object = {
    test: 123,
  };

  throws(
    () => {
      dotProp.set(object, "__proto__.isPolluted", true);
    },
    {
      message: "Cannot add property isPolluted, object is not extensible",
    }
  );
});
