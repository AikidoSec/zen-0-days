const { test } = require("node:test");
const { equal, throws } = require("node:assert");

test("Protects against Prototype Pollution", async () => {
  const lib = require("js-object-utilities");

  require("@aikidosec/firewall/nopp");

  var someObj = {
    test: 42,
  };

  equal({}.polluted, undefined);

  throws(
    () => {
      lib.set(someObj, "__proto__.polluted", 123);
    },
    {
      message: "Cannot add property polluted, object is not extensible",
    }
  );

  equal({}.polluted, undefined);
});
