const { test } = require("node:test");
const { equal, rejects } = require("node:assert");

test("Vulnerable to SSRF", async () => {
  const axios = require("axios");
  const internalAPIClient = axios.create({
    baseURL: "https://httpbin.org",
    headers: {
      "X-API-KEY": "1234567890",
    },
  });

  const response = await internalAPIClient.get("/get");
  equal(response.status, 200); // Normal request is successful

  const userInput = "/127.0.0.1:8080";

  await rejects(internalAPIClient.get(`/${userInput}`), {
    message: "connect ECONNREFUSED 127.0.0.1:8080", // Expect connection refused
  });
});
